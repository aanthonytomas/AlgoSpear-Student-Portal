import{S as d}from"./config-Cif4XynF.js";import{q as v}from"./fetchSingle-C22NpKvN.js";import{d as D,p as m,t as C,S as M,_ as q,c as N,a as i,j as u,k as A,m as O,o as w}from"./index-D7cRCgpj.js";import{q as b}from"./count-B2fEAVCc.js";import{q as P}from"./insertGetID-BAx1ISz1.js";import{t as L}from"./timer-OaxQmgbO.js";async function G(e){return new Promise(async t=>{await v({connection:d().CONN_NPM_LMS,table:"article",where:[["topic_refid",e]]}).then(async s=>t(s))})}async function R({article_refid:e,topic_refid:t,user_refid:s}){return new Promise(async a=>{await b({connection:d().CONN_NPM_LMS,table:"article_reads",where:[["article_refid",e],["topic_refid",t],["user_refid",s]]}).then(async n=>{if(n==0)await P({connection:d().CONN_NPM_LMS,table:"article_reads",columns:{article_refid:e,topic_refid:t,user_refid:s}}).then(async()=>a({success:!0,message:"Record created"}));else return a({success:!1,message:"Record exist"})})})}function Q(){const e=window.scrollY,t=800,s=performance.now(),a=r=>r<.5?2*r*r:-1+(4-2*r)*r,n=r=>{const l=r-s,o=Math.min(l/t,1),c=a(o);window.scrollTo(0,e-e*c),o<1&&requestAnimationFrame(n)};requestAnimationFrame(n)}const $=D({name:"SectionArticleHeader",emits:["completed"],props:{article:{default:{},type:Object},user:{default:{},type:Object},reset:{default:0,type:Number}},data(){return{timeDisplay:{}}},methods:{startTimer(){var e;L(async t=>{var s,a,n;m("Reading Time:",C(t)),this.timeDisplay=t,(t==null?void 0:t.seconds)==0&&await R({article_refid:(s=this.article)==null?void 0:s.article_refid,topic_refid:(a=this.article)==null?void 0:a.topic_refid,user_refid:(n=this.user)==null?void 0:n.user_refid}).then(async r=>{console.log("asdasd: ",r),M.fire({title:"Completed",text:"Allocated reading time completed",icon:"success"}).then(async()=>{m("Reading Status:","Completed"),this.$emit("completed")})})},(e=this.article)==null?void 0:e.reading_time)}},watch:{reset:async function(){var e,t;this.reset>0&&await b({connection:d().CONN_NPM_LMS,table:"article_reads",where:[["article_refid",(e=this.article)==null?void 0:e.article_refid],["user_refid",(t=this.user)==null?void 0:t.user_refid]]}).then(async s=>{m("Seen:",s),s==1?this.$emit("completed"):this.startTimer()})}}}),j={class:"d-flex justify-content-between align-items-center"},k={class:"d-flex align-items-center"},B={class:"p-0 m-0",style:{"line-height":"1"}},T={key:0,class:"progress rounded-0 mt-2",style:{height:"6px"}};function F(e,t,s,a,n,r){var l,o,c,p,f,y,h,g,_,S;return w(),N("div",null,[i("div",j,[i("div",null,[i("h3",null,u((l=e.article)!=null&&l.description?(o=e.article)==null?void 0:o.description:"No seclection"),1)]),i("div",null,[i("div",k,[t[2]||(t[2]=i("div",null,[i("i",{class:"bi bi-alarm fs-2 me-2"})],-1)),i("div",null,[i("p",B,[i("small",null,"Time: "+u((c=e.timeDisplay)!=null&&c.formatted?(p=e.timeDisplay)==null?void 0:p.formatted:"00:00:00")+" | Used: "+u((f=e.timeDisplay)!=null&&f.percentage?((h=(y=e.timeDisplay)==null?void 0:y.percentage)==null?void 0:h.used)+"%":"0%"),1),t[0]||(t[0]=i("br",null,null,-1)),t[1]||(t[1]=i("small",null,"Allocated reading time",-1))]),(g=e.timeDisplay)!=null&&g.percentage?(w(),N("div",T,[i("div",{class:"progress-bar progress-bar-striped",role:"progressbar",style:O({width:((S=(_=e.timeDisplay)==null?void 0:_.percentage)==null?void 0:S.used)+"%"}),"aria-valuenow":10,"aria-valuemin":0,"aria-valuemax":"100"},null,4)])):A("",!0)])])])])])}const U=q($,[["render",F]]);export{U as S,G as f,Q as s};
