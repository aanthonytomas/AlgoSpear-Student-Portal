import{j as $}from"./jlconfig-C6IE3CR_.js";import{d as B,t as C,S as b,i as Z,_ as q,c as a,a as s,F as U,h as E,o as n,j as d,g as T,n as A,k as D,l as G,m as ee,p as M,q as z,u as W,s as V,e as S,w as P,f as k,v as I,x as R,y as se}from"./index-BI8-wN6e.js";import{q as te}from"./url-Cahlg-je.js";import{_ as ie,f as oe}from"./new-banner-C1y5nPW9.js";import{S as j}from"./config-Cif4XynF.js";import{q as J}from"./fetchAll-D6z2HXB4.js";import{r as ne}from"./randomNumber-C27Mv2PT.js";import{S as K,f as X}from"./swiper-vue-i4w8B2bp.js";import{a as re,S as ae}from"./SectionFooter-DD-S-wB-.js";import{q as le}from"./insertGetID-Brze0Scj.js";import{t as de}from"./timer-OaxQmgbO.js";import{E as ce}from"./ElemProgressbar-Bi_UUSb7.js";import"./format-CV38ky4f.js";async function ue(){return new Promise(async e=>{await J({connection:j().CONN_NPM_LMS,table:"questionnaire_category",where:[["dataid",">",0]],orderby:["sort","asc"]}).then(async t=>e(t))})}async function he(e){return new Promise(async t=>{await J({connection:j().CONN_NPM_LMS,table:"questionnaire_category_done",where:[["user_refid","=",e]],orderby:["dataid","desc"]}).then(async o=>t(o))})}const me=B({name:"TopicList",emits:["view"],props:{excercise:{default:()=>({}),type:Object},locked:{default:!0}},setup(){return{jlconfig:$}},methods:{calculateTotalAttempts(e){return this.isUserAuthenticated()?Array.isArray(e==null?void 0:e.attempts)?e.attempts.length:(e==null?void 0:e.attempts)||0:0},calculateHighestScore(e){if(!this.isUserAuthenticated())return 0;if(Array.isArray(e==null?void 0:e.attempts)){const t=e.attempts.map(o=>o.score||0);return Math.max(...t,0)}return(e==null?void 0:e.highest_score)||0},isUserAuthenticated(){return Z()},handleButtonClick(e){e!=null&&e.passed?this.showCompletionAlert(e):this.locked||!this.isUserAuthenticated()?this.isUserAuthenticated()?this.$toast.warning("All exercise must be passed"):this.showLoginAlert():this.onSelectExam(e)},showCompletionAlert(e){const t=Object.values(this.excercise).every(o=>o==null?void 0:o.passed);b.fire({title:"Congratulations!",text:t?"You've passed the quiz":"You've passed this quiz, take another quiz",icon:t?"success":"info"})},showLoginAlert(){b.fire({title:"Sign In Required",text:"You need to sign in to start a quiz",icon:"warning"}).then(async()=>{this.$router.replace("/login")})},onSelectExam(e){this.isUserAuthenticated()?this.$emit("view",C(e)):this.showLoginAlert()}}}),pe={class:"p-5 mx-5"},fe={class:"row"},ye={class:"card"},_e={class:"card-body"},we={key:0,class:"badge bg-success"},ge={key:1,class:"badge bg-danger"},be={key:2,class:"badge bg-secondary"},ve={class:"card-footer d-flex justify-content-end"},$e=["onClick"],ke={key:0,class:"bi bi-lock-fill me-1"},Qe={key:1,class:"bi bi-check-circle-fill text-white me-1"},Se={key:2,class:"bi bi-unlock-fill me-1"};function Ce(e,t,o,m,p,g){return n(),a("div",pe,[s("div",fe,[(n(!0),a(U,null,E(e.excercise,(i,_)=>{var c;return n(),a("div",{class:"col-4 mb-5",key:_},[s("div",ye,[t[3]||(t[3]=s("img",{src:ie},null,-1)),s("div",_e,[s("h3",null,d((c=i==null?void 0:i.header)==null?void 0:c.name),1),s("table",null,[s("tbody",null,[s("tr",null,[t[0]||(t[0]=s("td",{style:{width:"180px"}},"Number of items",-1)),s("td",null,": "+d(e.jlconfig.quiz_limit),1)]),s("tr",null,[t[2]||(t[2]=s("td",null,"Status",-1)),s("td",null,[t[1]||(t[1]=T(": ")),i!=null&&i.completed&&(i!=null&&i.passed)?(n(),a("span",we,"Passed")):i!=null&&i.completed&&!(i!=null&&i.passed)?(n(),a("span",ge,"Fail")):(n(),a("span",be,"Pending"))])])])])]),s("div",ve,[s("button",{class:A(["btn w-100",[i!=null&&i.passed?"btn-success":e.locked||!e.isUserAuthenticated()?"btn-secondary":"btn-primary"]]),onClick:l=>e.handleButtonClick(i)},[e.locked||!e.isUserAuthenticated()?(n(),a("i",ke)):i!=null&&i.passed?(n(),a("i",Qe)):(n(),a("i",Se)),s("span",null,d(i!=null&&i.passed?"PASSED":(i==null?void 0:i.attempts)>0&&!(i!=null&&i.passed)?"Take again":(i==null?void 0:i.attempts)>0&&(i!=null&&i.passed)?"Passed":"Start Now"),1)],10,$e)])])])}),128))])])}const De=q(me,[["render",Ce]]),ze=B({name:"QuizResultPreview",emits:["back","retry"],props:{category:{type:Object,required:!0},questions:{type:Array,required:!0},score:{type:Number,required:!0},passed:{type:Boolean,required:!0},timeUsed:{type:String,required:!0,default:"00:00"}},data(){return{selectedQuestionIndex:0,selectedQuestion:null,showQuestionModal:!1,choices:{}}},computed:{typedQuestions(){return this.questions},isPassed(){return this.passed}},methods:{onBack(){this.$emit("back")},onRetry(){b.fire({title:"Try Again?",text:"You will restart the quiz with new questions. Are you sure?",icon:"question",showCancelButton:!0,confirmButtonText:"Yes, restart",cancelButtonText:"No, stay here"}).then(e=>{e.isConfirmed&&this.$emit("retry")})},showQuestionDetails(e){this.selectedQuestionIndex=e,this.selectedQuestion=this.questions[e],this.selectedQuestion&&this.selectedQuestion.is_choices&&(this.choices={a:this.selectedQuestion.choice_a||"",b:this.selectedQuestion.choice_b||"",c:this.selectedQuestion.choice_c||"",d:this.selectedQuestion.choice_d||""}),this.showQuestionModal=!0,document.body.style.overflow="hidden"},closeQuestionModal(){this.showQuestionModal=!1,document.body.style.overflow=""},getChoiceClass(e){return this.selectedQuestion?{"bg-success-dark":this.selectedQuestion.is_correct===1&&this.selectedQuestion.answer_input===e,"bg-danger":this.selectedQuestion.is_correct===0&&this.selectedQuestion.answer_input===e,"bg-success-light":this.selectedQuestion.is_correct===0&&this.selectedQuestion.answer.toLowerCase()===e}:{}},truncateQuestion(e,t){return e&&e.length>t?e.substring(0,t)+"...":e||""},formatAnswerWithoutPrefix(e){if(e.is_choices){const o={a:e.choice_a||"",b:e.choice_b||"",c:e.choice_c||"",d:e.choice_d||""}[e.answer_input]||"";return o?this.truncateQuestion(o,55):"Not answered"}else return e.answer_input||"Not answered"}},beforeUnmount(){document.body.style.overflow=""}}),Ie={class:"container mb-4 custom-mt"},Pe={class:"row"},Re={class:"col-sm-12 col-lg-12"},Ae={class:"card mb-4 mt-2"},Ue={class:"card-header d-flex justify-content-between align-items-center"},Ee={class:"badge bg-primary"},Te={class:"card-body"},Be={class:"progress mb-3",style:{height:"30px"}},qe=["aria-valuenow"],Ne={key:0,class:"alert alert-success mb-3"},Me={key:1,class:"alert alert-danger mb-3"},Ve={class:"d-flex align-items-center mb-3"},je={class:"card-body p-0"},Le={class:"table-responsive"},Ye={class:"table table-hover table-striped mb-0"},Fe=["onClick"],xe={class:"card-footer d-flex justify-content-between"},Oe={class:"question-modal-header"},He={class:"question-modal-body"},Ge={class:"mb-3"},We={key:0},Je={key:1},Ke={class:"input-group mb-3"},Xe=["value"],Ze={key:0,class:"input-group mb-3"},es=["value"],ss={class:"question-modal-footer"};function ts(e,t,o,m,p,g){var i,_,c,l,w,f,y;return n(),a("div",Ie,[t[15]||(t[15]=s("h1",{class:"text-center"},"Quiz Results",-1)),s("div",Pe,[t[12]||(t[12]=s("div",{class:"col-sm-0 col-lg-3"},null,-1)),s("div",Re,[s("div",Ae,[s("div",Ue,[t[6]||(t[6]=s("span",null,"Quiz Summary",-1)),s("span",Ee,"Score: "+d(e.score)+" / "+d(e.questions.length),1)]),s("div",Te,[s("div",Be,[s("div",{class:"progress-bar bg-success",role:"progressbar",style:G({width:e.score/e.questions.length*100+"%"}),"aria-valuenow":e.score/e.questions.length*100,"aria-valuemin":"0","aria-valuemax":"100"},d(Math.round(e.score/e.questions.length*100))+"% ",13,qe)]),e.isPassed?(n(),a("div",Ne,t[7]||(t[7]=[s("i",{class:"bi bi-check-circle-fill me-2"},null,-1),T(" Congratulations! You passed the quiz. ")]))):(n(),a("div",Me,t[8]||(t[8]=[s("i",{class:"bi bi-x-circle-fill me-2"},null,-1),T(" You did not pass the quiz. ")]))),s("div",Ve,[t[9]||(t[9]=s("div",null,[s("i",{class:"bi bi-alarm fs-3 text-primary me-2"})],-1)),s("div",null,"Remaining Time: "+d(e.timeUsed),1)]),s("div",null,[t[11]||(t[11]=s("div",{class:"card-header d-flex justify-content-between align-items-center"},[s("strong",null,"Questions Overview"),s("p",null,"Select list to view")],-1)),s("div",je,[s("div",Le,[s("table",Ye,[t[10]||(t[10]=s("thead",null,[s("tr",null,[s("th",{style:{width:"10%"}},"#"),s("th",{style:{width:"55%"}},"Question"),s("th",{style:{width:"35%"}},"Your Answer")])],-1)),s("tbody",null,[(n(!0),a(U,null,E(e.typedQuestions,(u,Q)=>(n(),a("tr",{key:Q,onClick:N=>e.showQuestionDetails(Q),role:"button",class:"question-row"},[s("td",null,d(Q+1),1),s("td",null,d(e.truncateQuestion(u.question,86)),1),s("td",{class:A(u.is_correct===1?"text-success fw-bold":"text-danger fw-bold")},d(e.formatAnswerWithoutPrefix(u)),3)],8,Fe))),128))])])])])])]),s("div",xe,[s("button",{class:"btn btn-secondary",onClick:t[0]||(t[0]=(...u)=>e.onBack&&e.onBack(...u))},"Back to Categories"),s("button",{class:"btn btn-primary",onClick:t[1]||(t[1]=(...u)=>e.onRetry&&e.onRetry(...u))},"Try Again")])])])]),e.showQuestionModal?(n(),a("div",{key:0,class:"question-modal-overlay",onClick:t[5]||(t[5]=(...u)=>e.closeQuestionModal&&e.closeQuestionModal(...u))},[s("div",{class:"question-modal-content",onClick:t[4]||(t[4]=ee(()=>{},["stop"]))},[s("div",Oe,[s("h5",null,"Question "+d(e.selectedQuestionIndex+1),1),s("button",{type:"button",class:"btn-close",onClick:t[2]||(t[2]=(...u)=>e.closeQuestionModal&&e.closeQuestionModal(...u))})]),s("div",He,[s("p",Ge,d((i=e.selectedQuestion)==null?void 0:i.question),1),(_=e.selectedQuestion)!=null&&_.is_choices?(n(),a("div",We,[(n(!0),a(U,null,E(e.choices,(u,Q)=>(n(),a("div",{key:Q,class:A(["choice-option p-3 mb-2 rounded",e.getChoiceClass(Q)])},d(u),3))),128))])):(n(),a("div",Je,[s("div",Ke,[t[13]||(t[13]=s("span",{class:"input-group-text"},"Your Answer",-1)),s("input",{type:"text",class:A(["form-control",{"bg-success-dark text-white":((c=e.selectedQuestion)==null?void 0:c.is_correct)===1,"bg-danger text-white":((l=e.selectedQuestion)==null?void 0:l.is_correct)===0}]),value:(w=e.selectedQuestion)==null?void 0:w.answer_input,disabled:""},null,10,Xe)]),((f=e.selectedQuestion)==null?void 0:f.is_correct)===0?(n(),a("div",Ze,[t[14]||(t[14]=s("span",{class:"input-group-text"},"Correct Answer",-1)),s("input",{type:"text",class:"form-control bg-success-light",value:(y=e.selectedQuestion)==null?void 0:y.answer,disabled:""},null,8,es)])):D("",!0)]))]),s("div",ss,[s("button",{type:"button",class:"btn btn-secondary",onClick:t[3]||(t[3]=(...u)=>e.closeQuestionModal&&e.closeQuestionModal(...u))},"Close")])])])):D("",!0)])}const is=q(ze,[["render",ts],["__scopeId","data-v-b2b09edf"]]),os=B({name:"ExamSpace",emits:["back","passed","fail"],props:{reset:{default:0,type:Number},category:{default:{},type:Object},questionnaires:{default:{},type:Object}},components:{Swiper:X,SwiperSlide:K,QuizResultPreview:is},setup(){return{store:W()}},data(){return{loading:{btn_submit:!1},user:{},swiper:{},list:[],score:0,passed:0,timeDisplay:{},exercise_duration:0,backButton:!1,stopTimer:null,isUserTryingToLeave:!1,isTimesUp:!1,answeredQuestions:[],canNavigatePrevious:!1,showResults:!1}},methods:{onPrevious(){this.swiper.activeIndex>0&&this.swiper.slidePrev()},async onBack(){var e;if(this.isTimesUp){(e=this.timeDisplay)!=null&&e.intervalID&&clearInterval(this.timeDisplay.intervalID),this.$router.push({path:this.$route.path,query:{}}),this.$emit("back");return}b.fire({title:"Are you sure?",text:"You will lose all your progress, are you sure you want to leave?",icon:"warning",showCancelButton:!0,confirmButtonText:"Yes, cancel",cancelButtonText:"No, continue "}).then(async t=>{var o;t.isConfirmed&&((o=this.timeDisplay)!=null&&o.intervalID&&clearInterval(this.timeDisplay.intervalID),this.$router.push({path:this.$route.path,query:{}}),this.$emit("back"))})},async startTimer(){this.stopTimer=de(async e=>{var t;z("Reading Time:",C(e)),this.timeDisplay=e,(e==null?void 0:e.seconds)==0&&(console.log("time is up"),this.isTimesUp=!0,this.$router.push({path:this.$route.path,query:{isTimesUp:"true"}}),(t=this.timeDisplay)!=null&&t.intervalID&&clearInterval(this.timeDisplay.intervalID),b.fire({title:"Time's up",text:"Your quiz time has ended.",icon:"info"}).then(async()=>{await this.onSaveExcercises().then(async()=>{this.loading.btn_submit=!1,this.showResults=!0})}))},this.exercise_duration)},async onSubmitAnswer(e){if(!this.list[e].answer_input)this.$toast.warning("Please provide your answer.");else{var t=this.list[e].answer.toLowerCase(),o=this.list[e].answer_input.toLowerCase();t==o?(this.score=this.score+1,this.list[e].is_correct=1):this.list[e].is_correct=0,this.answeredQuestions.includes(e)||this.answeredQuestions.push(e),this.answeredQuestions.length>0&&(this.canNavigatePrevious=!0),this.swiper.isEnd?(this.score>=$.quiz_limit_passing&&(this.passed=1),this.loading.btn_submit=!0,await this.onSaveExcercises().then(async()=>{var g;this.loading.btn_submit=!1,(g=this.timeDisplay)!=null&&g.intervalID&&clearInterval(this.timeDisplay.intervalID),this.isTimesUp=!0,this.$router.push({path:this.$route.path,query:{}});const m=this.passed?`Congratulations! You passed the quiz with a score of ${this.score}/${$.quiz_limit}.`:`You failed the quiz with a score of ${this.score}/${$.quiz_limit}. Better luck next time!`,p=this.passed?"success":"error";await b.fire({title:this.passed?"Quiz Passed!":"Quiz Failed",text:m,icon:p,confirmButtonText:"View Results"}),this.showResults=!0})):this.swiper.slideNext()}},async onSaveExcercises(){var e,t,o;await le({connection:j().CONN_NPM_LMS,table:"questionnaire_category_quiz",columns:{user_refid:(e=this.user)==null?void 0:e.user_refid,category_refid:(o=(t=this.category)==null?void 0:t.header)==null?void 0:o.group_refid,total:$.quiz_limit,score:this.score,passed:this.passed}})},onSwiper(e){this.swiper=e},onResultsBack(){this.$emit("back")},onResultsRetry(){this.showResults=!1,this.score=0,this.passed=0,this.isTimesUp=!1,this.answeredQuestions=[],this.canNavigatePrevious=!1,this.list.forEach(e=>{e.answer_input="",e.is_correct=0}),this.swiper.slideTo(0),this.startTimer()}},watch:{timeDisplay:function(e,t){(e==null?void 0:e.intervalID)!==(t==null?void 0:t.intervalID)&&(this.store.commit("addIntervalId",e==null?void 0:e.intervalID),console.log("added interval id"))},reset:async function(){if(this.reset>0){var e=await M();e?(this.user=e,this.list=this.questionnaires,this.score=0,this.passed=0,this.isTimesUp=!1,this.showResults=!1,this.swiper.slideTo(0),this.answeredQuestions=[],this.canNavigatePrevious=!1,z("Props:",C(this.$props)),z("Data:",C(this.$data)),this.$router.push({path:this.$route.path,query:{isQuizOngoing:"true"}}),this.startTimer()):(this.$router.replace("/login"),b.fire({title:"Sign In Required",text:"You need to sign in to start a quiz",icon:"info"}))}}},created(){this.exercise_duration=$.quiz_time*60,this.isTimesUp=!1,this.answeredQuestions=[],this.canNavigatePrevious=!1,this.showResults=!1},beforeUnmount(){var e;console.log("Component Destroyed!"),(e=this.timeDisplay)!=null&&e.intervalID&&clearInterval(this.timeDisplay.intervalID)}}),ns={key:0},rs={class:"text-center"},as={class:"row"},ls={class:"col-sm-12 col-lg-6"},ds={class:"mb-3 mt-2"},cs={class:"p-3"},us={class:"d-flex align-items-center"},hs={class:"flex-grow-1"},ms={class:"d-flex justify-content-between align-items-center"},ps={class:"p-0 m-0 fw-bold"},fs={class:"badge bg-primary"},ys={key:0,class:"progress mt-2",style:{height:"8px"}},_s=["aria-valuenow"],ws={class:"card mb-4 mt-2"},gs={class:"card-header d-flex justify-content-between align-items-center"},bs={class:"badge bg-secondary"},vs={class:"card-body"},$s={key:0},ks={class:"form-check mb-2"},Qs=["onUpdate:modelValue","name","id"],Ss=["for"],Cs={class:"form-check mb-2"},Ds=["onUpdate:modelValue","name","id"],zs=["for"],Is={class:"form-check mb-2"},Ps=["onUpdate:modelValue","name","id"],Rs=["for"],As={class:"form-check mb-2"},Us=["onUpdate:modelValue","name","id"],Es=["for"],Ts={key:1,class:"input-group mb-3"},Bs=["onUpdate:modelValue"],qs={class:"card-footer d-flex justify-content-between"},Ns=["disabled"],Ms=["onClick","disabled"],Vs={key:0},js={key:1},Ls={class:"row mt-3"},Ys={class:"col-sm-12 col-lg-6 d-flex justify-content-start"};function Fs(e,t,o,m,p,g){var l,w,f,y,u,Q,N,L,Y,F,x,O,H;const i=k("swiper-slide"),_=k("swiper"),c=k("quiz-result-preview");return n(),a("div",null,[e.showResults?D("",!0):(n(),a("div",ns,[s("h1",rs,d((w=(l=e.category)==null?void 0:l.header)==null?void 0:w.name),1),s("div",as,[t[5]||(t[5]=s("div",{class:"col-sm-0 col-lg-3"},null,-1)),s("div",ls,[s("div",ds,[s("div",cs,[s("div",us,[t[2]||(t[2]=s("div",null,[s("i",{class:"bi bi-alarm fs-3 text-primary"})],-1)),s("div",hs,[s("div",ms,[s("p",ps,d((f=e.timeDisplay)!=null&&f.formatted?(y=e.timeDisplay)==null?void 0:y.formatted:"00:00:00"),1),s("span",fs," Used: "+d((u=e.timeDisplay)!=null&&u.percentage?((N=(Q=e.timeDisplay)==null?void 0:Q.percentage)==null?void 0:N.used)+"%":"0%"),1)]),(L=e.timeDisplay)!=null&&L.percentage?(n(),a("div",ys,[s("div",{class:"progress-bar progress-bar-striped bg-primary",role:"progressbar",style:G({width:((F=(Y=e.timeDisplay)==null?void 0:Y.percentage)==null?void 0:F.used)+"%"}),"aria-valuenow":(O=(x=e.timeDisplay)==null?void 0:x.percentage)==null?void 0:O.used,"aria-valuemin":0,"aria-valuemax":"100"},null,12,_s)])):D("",!0)])])])]),S(_,{"slides-per-view":1,onSwiper:e.onSwiper},{default:P(()=>[(n(!0),a(U,null,E(e.list,(r,h)=>(n(),V(i,{class:"swiper-no-swiping",key:h},{default:P(()=>[s("div",ws,[s("div",gs,[s("span",null,"Question: "+d(h+1),1),s("span",bs,d(h+1)+" of "+d(e.list.length),1)]),s("div",vs,[s("p",null,d(r==null?void 0:r.question),1),r!=null&&r.is_choices?(n(),a("div",$s,[s("div",ks,[I(s("input",{"onUpdate:modelValue":v=>r.answer_input=v,class:"form-check-input",type:"radio",name:"flexRadioDefault_"+h,id:"choice_a_"+h,value:"a"},null,8,Qs),[[R,r.answer_input]]),s("label",{class:"form-check-label",for:"choice_a_"+h},d(r==null?void 0:r.choice_a),9,Ss)]),s("div",Cs,[I(s("input",{"onUpdate:modelValue":v=>r.answer_input=v,class:"form-check-input",type:"radio",name:"flexRadioDefault_"+h,id:"choice_b_"+h,value:"b"},null,8,Ds),[[R,r.answer_input]]),s("label",{class:"form-check-label",for:"choice_b_"+h},d(r==null?void 0:r.choice_b),9,zs)]),s("div",Is,[I(s("input",{"onUpdate:modelValue":v=>r.answer_input=v,class:"form-check-input",type:"radio",name:"flexRadioDefault_"+h,id:"choice_c_"+h,value:"c"},null,8,Ps),[[R,r.answer_input]]),s("label",{class:"form-check-label",for:"choice_c_"+h},d(r==null?void 0:r.choice_c),9,Rs)]),s("div",As,[I(s("input",{"onUpdate:modelValue":v=>r.answer_input=v,class:"form-check-input",type:"radio",name:"flexRadioDefault_"+h,id:"choice_d_"+h,value:"d"},null,8,Us),[[R,r.answer_input]]),s("label",{class:"form-check-label",for:"choice_d_"+h},d(r==null?void 0:r.choice_d),9,Es)])])):(n(),a("div",Ts,[t[3]||(t[3]=s("span",{class:"input-group-text"},"Answer",-1)),I(s("input",{"onUpdate:modelValue":v=>r.answer_input=v,type:"text",class:"form-control"},null,8,Bs),[[se,r.answer_input]])]))]),s("div",qs,[s("button",{class:"btn btn-secondary w-49",onClick:t[0]||(t[0]=v=>e.onPrevious()),disabled:!e.canNavigatePrevious},"Previous",8,Ns),s("button",{class:"btn btn-primary w-49",onClick:v=>e.onSubmitAnswer(h),disabled:e.loading.btn_submit},[e.loading.btn_submit?(n(),a("span",Vs,t[4]||(t[4]=[s("span",{class:"spinner-border spinner-border-sm me-2",role:"status"},null,-1),T(" Please wait.. ")]))):(n(),a("span",js,"Submit Answer"))],8,Ms)])])]),_:2},1024))),128))]),_:1},8,["onSwiper"])])]),s("div",Ls,[t[6]||(t[6]=s("div",{class:"col-sm-0 col-lg-3"},null,-1)),s("div",Ys,[s("button",{class:"btn btn-secondary w-50",onClick:t[1]||(t[1]=r=>e.onBack())},"Back")])])])),e.showResults?(n(),V(c,{key:1,category:e.category,questions:e.list,score:e.score,passed:e.passed===1,timeUsed:((H=e.timeDisplay)==null?void 0:H.formatted)||"00:00:00",onBack:e.onResultsBack,onRetry:e.onResultsRetry},null,8,["category","questions","score","passed","timeUsed","onBack","onRetry"])):D("",!0)])}const xs=q(os,[["render",Fs],["__scopeId","data-v-ea150b12"]]),Os=B({components:{ElemProgressbar:ce,ExamSpace:xs,TopicList:De,SectionHeader:ae,SectionFooter:re,Swiper:X,SwiperSlide:K},setup(){const e=W();return{jlconfig:$,store:e}},data(){return{loading:!1,user:{},excercise:[],reset:0,category:{},categories:[],exercises:[],questionnaires:{},lockedQuiz:!0,examVue:!1,confettiRunning:!1,swiper:{}}},methods:{async initExercises(){var e,t,o;this.loading=!0;try{const[m,p,g,i]=await Promise.all([M(),te({url:`util_quiz/initQuiz?user_refid=${(e=this.user)==null?void 0:e.user_refid}&limit=${$.excercises_limit}`}),he((t=this.user)==null?void 0:t.user_refid),ue()]);m&&(this.user=m);const _=p.map(l=>{const w=g.filter(f=>f.category_refid===l.header.group_refid);return{...l,attempts:w,highest_score:Math.max(...w.map(f=>f.score||0),0),total_attempts:w.length}});this.loading=!1,this.excercise=_,this.exercises=g.filter(l=>l==null?void 0:l.passed),this.categories=i;const c=(o=this.categories)==null?void 0:o.every(l=>{var f;let w=l==null?void 0:l.group_refid;return(f=this.exercises)==null?void 0:f.some(y=>(y==null?void 0:y.category_refid)==w&&(y==null?void 0:y.passed))});this.lockedQuiz=!c,c&&this.startQuizPassedCelebration(),z("Quiz Status",{locked:this.lockedQuiz,exercises:this.excercise})}catch(m){console.error("Error initializing exercises:",m),this.loading=!1,b.fire({title:"Error",text:"Failed to load exercises. Please try again.",icon:"error"})}},startQuizPassedCelebration(){var _;if(this.confettiRunning||!((_=this.excercise)==null?void 0:_.every(c=>c==null?void 0:c.passed)))return;this.confettiRunning=!0;const t=["#bb0000","#161179","#015551"],o=15*1e3,m=Date.now()+o,p={startVelocity:30,spread:360,ticks:60,zIndex:0},g=(c,l)=>Math.random()*(l-c)+c,i=setInterval(()=>{const c=m-Date.now();if(c<=0){clearInterval(i),this.confettiRunning=!1;return}const l=50*(c/o);confetti({...p,particleCount:l,origin:{x:g(.1,.3),y:Math.random()-.2},colors:t}),confetti({...p,particleCount:l,origin:{x:g(.7,.9),y:Math.random()-.2},colors:t})},250);b.fire({title:"Congratulations!",text:"You've passed all quizzes!",icon:"success",imageUrl:"/src/assets/img/new-awards.png",confirmButtonText:"Great!"})},async viewExam(e){var t;if(z("View Exam",e),e!=null&&e.passed){b.fire({title:"Completed",text:"You've passed the quiz already",imageUrl:"/src/assets/img/new-locked.png"});return}this.examVue=!0,this.loading=!0,this.category=C(e);try{const o=await oe({group_refid:(t=e==null?void 0:e.header)==null?void 0:t.group_refid,limit:$.quiz_limit}),m=o==null?void 0:o.filter(p=>p==null?void 0:p.is_choices).slice(0,$.quiz_limit);if(m.length<$.quiz_limit){b.fire({title:"Wait",text:"Questions in this quiz are not yet prepared.",icon:"warning"}),this.loading=!1;return}this.loading=!1,this.questionnaires=C(m),this.reset=ne(),this.swiper.slideTo(1)}catch(o){console.error("Error fetching exam:",o),this.loading=!1,b.fire({title:"Error",text:"Failed to load exam. Please try again.",icon:"error"})}},onSwiper(e){this.swiper=e},onBack(){this.swiper.slideTo(0),this.examVue=!1,this.clearIntervals()},clearIntervals(){this.store&&this.store.state.intervalIds&&(this.store.state.intervalIds.forEach(e=>{clearInterval(e)}),this.store.commit("clearIntervalIds"))},async onPassed(){this.swiper.slideTo(0),await this.initExercises(),this.clearIntervals()},async onFail(){this.swiper.slideTo(0),await this.initExercises(),this.clearIntervals()}},async mounted(){try{var e=await M();e&&(this.user=e),await this.initExercises().then(async()=>{z("Quiz:",C(this.$data))}),this.$router.push({path:this.$route.path,query:{}})}catch(t){console.error("Mounted error:",t)}},beforeDestroy(){this.clearIntervals()}}),Hs={class:"main"},Gs={class:"container mt-5 py-5"},Ws={class:"row pt-5"},Js={class:"col-4"},Ks={class:"col-12"};function Xs(e,t,o,m,p,g){const i=k("SectionHeader"),_=k("ElemProgressbar"),c=k("TopicList"),l=k("swiper-slide"),w=k("ExamSpace"),f=k("swiper"),y=k("SectionFooter");return n(),a("div",null,[S(i),s("main",Hs,[s("div",Gs,[s("div",Ws,[t[0]||(t[0]=s("div",{class:"col-12"},[s("h1",{class:"text-center fw-bold display-6"},"Quiz"),s("p",{class:"text-center"},"Select category to start")],-1)),t[1]||(t[1]=s("div",{class:"col-4"},null,-1)),s("div",Js,[S(_,{loading:e.loading},null,8,["loading"])]),t[2]||(t[2]=s("div",{class:"col-4"},null,-1)),s("div",Ks,[S(f,{"slides-per-view":1,"space-between":0,onSwiper:e.onSwiper},{default:P(()=>[S(l,{class:"swiper-no-swiping"},{default:P(()=>[S(c,{excercise:e.excercise,locked:e.lockedQuiz,onView:e.viewExam},null,8,["excercise","locked","onView"])]),_:1}),e.examVue?(n(),V(l,{key:0,class:"swiper-no-swiping"},{default:P(()=>[S(w,{reset:e.reset,category:e.category,questionnaires:e.questionnaires,onBack:e.onBack,onPassed:e.onPassed,onFail:e.onFail},null,8,["reset","category","questionnaires","onBack","onPassed","onFail"])]),_:1})):D("",!0)]),_:1},8,["onSwiper"])])])])]),S(y)])}const ht=q(Os,[["render",Xs],["__scopeId","data-v-6e9bfd1f"]]);export{ht as default};
