import{j as c}from"./jlconfig-bK2FoTvF.js";import{d as E,i as A,t as y,S as h,_ as x,c as l,a as s,F as L,h as R,o as r,j as d,g as q,n as H,l as Y,p as g,e as f,k as F,m as G,w as $,f as p,q as Q,s as k,u as C,v as W}from"./index-D7cRCgpj.js";import{q as J}from"./url-HQ3Cey_0.js";import{_ as K,f as X}from"./excercises-banner-LhtmD0ag.js";import{S as N}from"./config-Cif4XynF.js";import{q as j}from"./fetchAll-BSL-E5rQ.js";import{r as Z}from"./randomNumber-C27Mv2PT.js";import{S as M,f as O}from"./swiper-vue-fHe_OmiB.js";import{a as ee,S as se}from"./SectionFooter-upHGNFKG.js";import{q as te}from"./insertGetID-BAx1ISz1.js";import{t as ie}from"./timer-OaxQmgbO.js";import{E as ae}from"./ElemProgressbar-DxHRhbjo.js";import"./format-CV38ky4f.js";async function oe(){return new Promise(async e=>{await j({connection:N().CONN_NPM_LMS,table:"questionnaire_category",where:[["dataid",">",0]],orderby:["sort","asc"]}).then(async t=>e(t))})}async function ne(e){return new Promise(async t=>{await j({connection:N().CONN_NPM_LMS,table:"questionnaire_category_done",where:[["user_refid","=",e]],orderby:["dataid","desc"]}).then(async n=>t(n))})}const re=E({name:"TopicList",emits:["view"],props:{excercise:{default:{},type:Object},locked:{default:!0}},setup(){return{jlconfig:c}},methods:{isUserAuthenticated(){return A()},onSelectExam(e){A()?this.$emit("view",y(e)):h.fire({title:"Sign In Required",text:"You need to sign in to start a quiz",icon:"info"}).then(async()=>{this.$router.replace("/login")})}}}),le={class:"p-5 mx-5"},ce={class:"row"},de={class:"card"},ue={class:"card-body"},he={key:0,class:"badge bg-success"},pe={key:1,class:"badge bg-danger"},me={key:2,class:"badge bg-secondary"},fe={class:"card-footer d-flex justify-content-end"},_e=["onClick"],ye={key:0,class:"bi bi-lock-fill me-1"},we={key:1,class:"bi bi-unlock-fill me-1"};function ge(e,t,n,o,m,b){return r(),l("div",le,[s("div",ce,[(r(!0),l(L,null,R(e.excercise,(i,v)=>{var _;return r(),l("div",{class:"col-4 mb-5",key:v},[s("div",de,[t[3]||(t[3]=s("img",{src:K},null,-1)),s("div",ue,[s("h3",null,d((_=i==null?void 0:i.header)==null?void 0:_.name),1),s("table",null,[s("tbody",null,[s("tr",null,[t[0]||(t[0]=s("td",{style:{width:"180px"}},"Number of items",-1)),s("td",null,": "+d(e.jlconfig.quiz_limit),1)]),s("tr",null,[t[2]||(t[2]=s("td",null,"Status",-1)),s("td",null,[t[1]||(t[1]=q(": ")),i!=null&&i.completed&&(i!=null&&i.passed)?(r(),l("span",he,"Passed")):i!=null&&i.completed&&!(i!=null&&i.passed)?(r(),l("span",pe,"Fail")):(r(),l("span",me,"Pending"))])])])])]),s("div",fe,[s("button",{class:H(["btn w-100",e.locked||!e.isUserAuthenticated()?"btn-secondary":"btn-primary"]),onClick:w=>e.locked?e.$toast.warning("All exercise must passed"):e.onSelectExam(i)},[e.locked||!e.isUserAuthenticated()?(r(),l("i",ye)):(r(),l("i",we)),s("span",null,d((i==null?void 0:i.attempt)>0&&!(i!=null&&i.passed)?"Take again":(i==null?void 0:i.attempt)>0&&(i!=null&&i.passed)?"Completed":"Start Now"),1)],10,_e)])])])}),128))])])}const be=x(re,[["render",ge],["__scopeId","data-v-e6300433"]]),ve=E({name:"TopicList",emits:["back","passed","fail"],props:{reset:{default:0,type:Number},category:{default:{},type:Object},questionnaires:{default:{},type:Object}},components:{Swiper:O,SwiperSlide:M},data(){return{loading:{btn_submit:!1},user:{},swiper:{},list:[],score:0,passed:0,timeDisplay:{},exercise_duration:0,backButton:!1,isUserTryingToLeave:!1,stopTimer:null}},methods:{async onBack(){h.fire({title:"Are you sure?",text:"You will lose all your progress, are you sure you want to leave?",icon:"warning",showCancelButton:!0,confirmButtonText:"Yes, cancel it",cancelButtonText:"No, continue"}).then(async e=>{var t;e.isConfirmed&&(clearInterval((t=this.timeDisplay)==null?void 0:t.intervalID),this.$router.push({path:this.$route.path,query:{}}),this.$emit("back"))})},async startTimer(){this.stopTimer=ie(async e=>{g("Reading Time:",y(e)),this.timeDisplay=e,(e==null?void 0:e.seconds)==0&&(console.log("time is up"),h.fire({title:"Time's up",text:"Your quiz time has ended.",icon:"info"}).then(async()=>{await this.onSaveExcercises().then(async()=>{this.loading.btn_submit=!1,this.passed==1?h.fire({title:"Congratulations",text:"You passed the quiz with score of "+this.score+" out of "+c.excercises_limit+".",icon:"success"}).then(async()=>{this.$emit("passed")}):h.fire({title:"You fail",text:"You fail to pass with score of "+this.score+" out of "+c.excercises_limit+".",icon:"error"}).then(async()=>{this.$emit("fail")})})}))},this.exercise_duration)},async onSubmitAnswer(e){if(!this.list[e].answer_input)this.$toast.warning("Please provide your answer.");else{var t=this.list[e].answer.toLowerCase(),n=this.list[e].answer_input.toLowerCase();t==n?(this.score=this.score+1,this.list[e].is_corrrect=1):this.list[e].is_corrrect=0,this.swiper.isEnd?(this.score>=c.quiz_limit_passing&&(this.passed=1),this.loading.btn_submit=!0,await this.onSaveExcercises().then(async()=>{var o;this.loading.btn_submit=!1,this.passed==1?h.fire({title:"Congratulations",text:"You passed the exercise with score of "+this.score+" out of "+c.quiz_limit+".",icon:"success"}).then(async()=>{this.$emit("passed")}):h.fire({title:"You fail",text:"You fail to pass with score of "+this.score+" out of "+c.quiz_limit+".",icon:"error"}).then(async()=>{this.$emit("fail")}),clearInterval((o=this.timeDisplay)==null?void 0:o.intervalID),this.$router.push({path:this.$route.path,query:{}})})):this.swiper.slideNext()}},async onSaveExcercises(){var e,t,n;await te({connection:N().CONN_NPM_LMS,table:"questionnaire_category_quiz",columns:{user_refid:(e=this.user)==null?void 0:e.user_refid,category_refid:(n=(t=this.category)==null?void 0:t.header)==null?void 0:n.group_refid,total:c.quiz_limit,score:this.score,passed:this.passed}})},onSwiper(e){this.swiper=e}},watch:{timeDisplay:function(e,t){(e==null?void 0:e.intervalID)!==(t==null?void 0:t.intervalID)&&console.log("Interval ID updated:",e==null?void 0:e.intervalID)},reset:async function(){if(this.reset>0){var e=await Y();e?(this.user=e,this.list=this.questionnaires,this.score=0,this.passed=0,this.swiper.slideTo(0),g("Props:",y(this.$props)),g("Data:",y(this.$data)),this.$router.push({path:this.$route.path,query:{isQuizOngoing:"true"}}),this.startTimer()):(this.$router.replace("/login"),h.fire({title:"Sign In Required",text:"You need to sign in to start a quiz",icon:"info"}).then(async()=>{}))}}},created(){this.exercise_duration=c.quiz_time*60},destroyed(){console.log("Component Destroyed!")}}),ke={class:"text-center"},$e={class:"row"},Se={class:"col-sm-12 col-lg-6"},ze={class:"d-flex align-items-center"},De={class:"p-0 m-0",style:{"line-height":"1"}},Ce={key:0,class:"progress rounded-0 mt-2",style:{height:"6px"}},Ee={class:"card mb-4"},xe={class:"card-header"},Ne={class:"card-body"},Pe={key:0},Te={class:"form-check"},Ie=["onUpdate:modelValue"],Ue={class:"form-check-label",for:"choice_a"},Ve={class:"form-check"},Be=["onUpdate:modelValue"],Ae={class:"form-check-label",for:"choice_b"},Le={class:"form-check"},Re=["onUpdate:modelValue"],Ye={class:"form-check-label",for:"choice_c"},Fe={class:"form-check"},Qe=["onUpdate:modelValue"],je={class:"form-check-label",for:"choice_d"},Me={key:1,class:"input-group mb-3"},Oe=["onUpdate:modelValue"],qe={class:"card-footer d-flex justify-content-end"},He=["onClick","disabled"],Ge={class:"d-flex justify-content-start"};function We(e,t,n,o,m,b){var _,w,S,z,D,P,T,I,U,V;const i=p("swiper-slide"),v=p("swiper");return r(),l("div",null,[s("h1",ke,d((w=(_=e.category)==null?void 0:_.header)==null?void 0:w.name),1),s("div",$e,[t[4]||(t[4]=s("div",{class:"col-sm-0 col-lg-3"},null,-1)),s("div",Se,[s("div",ze,[t[2]||(t[2]=s("div",null,[s("i",{class:"bi bi-alarm fs-2 me-2"})],-1)),s("div",null,[s("p",De,[s("small",null,"Time: "+d((S=e.timeDisplay)!=null&&S.formatted?(z=e.timeDisplay)==null?void 0:z.formatted:"00:00:00")+" | Used: "+d((D=e.timeDisplay)!=null&&D.percentage?((T=(P=e.timeDisplay)==null?void 0:P.percentage)==null?void 0:T.used)+"%":"0%"),1),t[1]||(t[1]=s("br",null,null,-1))]),(I=e.timeDisplay)!=null&&I.percentage?(r(),l("div",Ce,[s("div",{class:"progress-bar progress-bar-striped",role:"progressbar",style:G({width:((V=(U=e.timeDisplay)==null?void 0:U.percentage)==null?void 0:V.used)+"%"}),"aria-valuenow":10,"aria-valuemin":0,"aria-valuemax":"100"},null,4)])):F("",!0)])]),f(v,{"slides-per-view":1,onSwiper:e.onSwiper},{default:$(()=>[(r(!0),l(L,null,R(e.list,(a,B)=>(r(),Q(i,{class:"swiper-no-swiping"},{default:$(()=>[s("div",Ee,[s("div",xe,"Question: "+d(B+1),1),s("div",Ne,[s("p",null,d(a==null?void 0:a.question),1),a!=null&&a.is_choices?(r(),l("div",Pe,[s("div",Te,[k(s("input",{"onUpdate:modelValue":u=>a.answer_input=u,class:"form-check-input",type:"radio",name:"flexRadioDefault",id:"choice_a",value:"a"},null,8,Ie),[[C,a.answer_input]]),s("label",Ue,d(a==null?void 0:a.choice_b),1)]),s("div",Ve,[k(s("input",{"onUpdate:modelValue":u=>a.answer_input=u,class:"form-check-input",type:"radio",name:"flexRadioDefault",id:"choice_b",value:"b"},null,8,Be),[[C,a.answer_input]]),s("label",Ae,d(a==null?void 0:a.choice_b),1)]),s("div",Le,[k(s("input",{"onUpdate:modelValue":u=>a.answer_input=u,class:"form-check-input",type:"radio",name:"flexRadioDefault",id:"choice_c",value:"c"},null,8,Re),[[C,a.answer_input]]),s("label",Ye,d(a==null?void 0:a.choice_c),1)]),s("div",Fe,[k(s("input",{"onUpdate:modelValue":u=>a.answer_input=u,class:"form-check-input",type:"radio",name:"flexRadioDefault",id:"choice_d",value:"d"},null,8,Qe),[[C,a.answer_input]]),s("label",je,d(a==null?void 0:a.choice_d),1)])])):(r(),l("div",Me,[t[3]||(t[3]=s("span",{class:"input-group-text"},"Answer",-1)),k(s("input",{"onUpdate:modelValue":u=>a.answer_input=u,type:"text",class:"form-control"},null,8,Oe),[[W,a.answer_input]])]))]),s("div",qe,[s("button",{class:"btn btn-primary w-50",onClick:u=>e.onSubmitAnswer(B),disabled:e.loading.btn_submit},d(e.loading.btn_submit?"Please wait..":"Submit Answer"),9,He)])])]),_:2},1024))),256))]),_:1},8,["onSwiper"]),s("div",Ge,[s("button",{class:"btn btn-secondary btn-lg me-4 w-50",onClick:t[0]||(t[0]=a=>e.onBack())},"Back")])]),t[5]||(t[5]=s("div",{class:"col-sm-0 col-lg-3"},null,-1))])])}const Je=x(ve,[["render",We]]),Ke=E({components:{ElemProgressbar:ae,ExamSpace:Je,TopicList:be,SectionHeader:se,SectionFooter:ee,Swiper:O,SwiperSlide:M},setup(){return{jlconfig:c}},data(){return{loading:!1,user:{},btn:{array:!0,search:!1,sorting:!1,linked_list:!1,graphs:!1,stacks:!1,queues:!1},swiper:{},excercise:{},reset:0,category:{},categories:[],exercises:[],questionnaires:{},lockedQuiz:!0,examVue:!0}},methods:{async initExercises(){var e,t,n;this.loading=!0,await J({url:"util_quiz/initQuiz?user_refid="+((e=this.user)==null?void 0:e.user_refid)+"&limit="+c.excercises_limit}).then(async o=>{this.loading=!1,this.excercise=o,this.isPassedAll()}),await ne((t=this.user)==null?void 0:t.user_refid).then(async o=>{this.exercises=o.filter(m=>m==null?void 0:m.passed),console.log("exercise: ",o)}),await oe().then(async o=>{this.categories=o,console.log("categories: ",o)}),this.lockedQuiz=!((n=this.categories)!=null&&n.every(o=>{var b;let m=o==null?void 0:o.group_refid;return(b=this.exercises)==null?void 0:b.some(i=>(i==null?void 0:i.category_refid)==m)})),console.log("quiz: ",this.lockedQuiz)},isPassedAll(){var e=0;for(let t=0;t<this.excercise.length;t++)this.excercise[t].passed&&(e=e+1);g("Over all status",{total:this.excercise.length,passed:e})},async viewExam(e){var t;g("View Exam",e),e!=null&&e.passed?h.fire({title:"Completed",text:"You've passed the exercises already",icon:"info"}):(this.examVue=!0,this.loading=!0,this.category=y(e),await X({group_refid:(t=e==null?void 0:e.header)==null?void 0:t.group_refid,limit:c.quiz_limit}).then(async n=>{n=n==null?void 0:n.filter(o=>o==null?void 0:o.is_choices).slice(0,c.quiz_limit),console.log(c.quiz_limit),n.length<c.quiz_limit?(h.fire({title:"Wait",text:"Questions in this quiz are not yet prepared.",icon:"info"}),this.loading=!1):(this.loading=!1,this.questionnaires=y(n),this.reset=Z(),this.swiper.slideTo(1))}))},onSwiper(e){this.swiper=e},onBack(){this.swiper.slideTo(0),this.examVue=!1},async onPassed(){this.swiper.slideTo(0),await this.initExercises().then(async()=>{})},async onFail(){this.swiper.slideTo(0),await this.initExercises().then(async()=>{})}},async mounted(){var e=await Y();e&&(this.user=e),await this.initExercises().then(async()=>{g("Quiz:",y(this.$data))}),this.$router.push({path:this.$route.path,query:{}})}}),Xe={class:"main"},Ze={class:"container mt-5 py-5"},es={class:"row mt-5 pt-5"},ss={class:"col-4"},ts={class:"col-12"};function is(e,t,n,o,m,b){const i=p("SectionHeader"),v=p("ElemProgressbar"),_=p("TopicList"),w=p("swiper-slide"),S=p("ExamSpace"),z=p("swiper"),D=p("SectionFooter");return r(),l("div",null,[f(i),s("main",Xe,[s("div",Ze,[s("div",es,[t[0]||(t[0]=s("div",{class:"col-12"},[s("h1",{class:"text-center"},"Quiz"),s("p",{class:"text-center"},"Select category to start")],-1)),t[1]||(t[1]=s("div",{class:"col-4"},null,-1)),s("div",ss,[f(v,{loading:e.loading},null,8,["loading"])]),t[2]||(t[2]=s("div",{class:"col-4"},null,-1)),s("div",ts,[f(z,{"slides-per-view":1,"space-between":0,onSwiper:e.onSwiper},{default:$(()=>[f(w,{class:"swiper-no-swiping"},{default:$(()=>[f(_,{excercise:e.excercise,locked:e.lockedQuiz,onView:e.viewExam},null,8,["excercise","locked","onView"])]),_:1}),e.examVue?(r(),Q(w,{key:0,class:"swiper-no-swiping"},{default:$(()=>[f(S,{reset:e.reset,category:e.category,questionnaires:e.questionnaires,onBack:e.onBack,onPassed:e.onPassed,onFail:e.onFail},null,8,["reset","category","questionnaires","onBack","onPassed","onFail"])]),_:1})):F("",!0)]),_:1},8,["onSwiper"])])])])]),f(D)])}const ys=x(Ke,[["render",is],["__scopeId","data-v-09d6b285"]]);export{ys as default};
